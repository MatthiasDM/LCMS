
<style>
    #container .row .col-sm-3{
        min-width: 300px; 
        margin: 10px;
    }
    /*    #container .card-title a{
            color: white;        
        }*/
</style>

<div class="container" style="width:100%" id="admin-container">

    <div class="card">
        <div class="card-header">
            Configuratie
        </div>
        <div class="card-body">
            <a class="badge bg-secondary" style="margin: 5px;" onclick="loadCollectionsv2()">Collecties</a>
            <a class="badge bg-secondary" style="margin: 5px;" onclick="loadCollections()">Database-objecten</a>
            <a class="badge bg-info" onclick="gcmscore.createTableModal('Database-acties', 'actions', $('#admin-container'))" style="margin: 5px;">Database-acties</a>            
            <a class="badge bg-warning" onclick="gcmscore.createTableModal('Gebruikers', 'users', $('#admin-container'))" style="margin: 5px;">Gebruikers</a>
            <a class="badge bg-secondary" onclick="gcmscore.createTableModal('Paginas', 'pages', $('#admin-container'))" style="margin: 5px;">Paginas</a>
            <a class="badge bg-info" onclick="gcmscore.createTableModal('Opdrachten', 'commands', $('#admin-container'))" style="margin: 5px;">Opdrachten</a>
            <a class="badge bg-warning" onclick="gcmscore.createTableModal('Werkstromen', 'workflows', $('#admin-container'))" style="margin: 5px;">Werkstromen</a>
            <a class="badge bg-info" onclick="gcmscore.createTableModal('API keys', 'apikeys', $('#admin-container'))" style="margin: 5px;">API keys</a>
            <a class="badge bg-secondary" onclick="gcmscore.createTableModal('Taken', 'chronjobs', $('#admin-container'))" style="margin: 5px;">Taken</a>
            <a class="badge bg-info" onclick="gcmscore.createTableModal('Rechten', 'rights', $('#admin-container'))" style="margin: 5px;">Rechten</a>
            <a class="badge bg-warning" onclick="gcmscore.createTableModal('Rollen', 'roles', $('#admin-container'))" style="margin: 5px;">Rollen</a>
            <a class="badge bg-success" onclick="queryModal()" style="margin: 5px;">Queries</a>
            <a class="badge bg-info" onclick="gcmscore.createTableModal('Berekende velden', 'calculatedFields', $('#admin-container'))" style="margin: 5px;">Berekende velden</a>
            <a class="badge bg-warning" onclick="gcmscore.createTableModal('Depedencies', 'dependencies', $('#admin-container'))" style="margin: 5px;">Depedencies</a>
            <a class="badge bg-success" onclick="gcmscore.createTableModal('Snippets', 'snippets', $('#admin-container'))" style="margin: 5px;">Snippets</a>
            <a class="badge bg-success" onclick="gcmscore.createTableModal('Methods', 'methods', $('#admin-container'))" style="margin: 5px;">Methods</a>

        </div>
    </div>
    <br/><br/>
</div>

<script>

    require(["ckeditor"], function () {
        config2(false);
    });



    async function loadCollections() {
        var lazyOptions = gcmscore.lazyOptions("mongoconfigurations");
        lazyOptions.afterLoadComplete = function (a, b) {
            b.addGridButton(new LCMSTemplateGridButton("fa-bars", "Show menu", "", function () {
                console.log("Show menu");
                var rowId = a.jqGrid('getGridParam', 'selrow');
                var rowData = a.jqGrid('getRowData', rowId);
                gcmscore.getSnippetPopup('collectionMenu', JSON.stringify(rowData));
            }));
        }
        gcmscore.createTableModal('Collections', 'mongoconfigurations', $('#admin-container'), null, lazyOptions);
    }
    
       async function loadCollectionsv2() {
        var lazyOptions = gcmscore.lazyOptions("collections");
        lazyOptions.afterLoadComplete = function (a, b) {
            b.addGridButton(new LCMSTemplateGridButton("fa-bars", "Show menu", "", function () {
                console.log("Show menu");
                var rowId = a.jqGrid('getGridParam', 'selrow');
                var rowData = a.jqGrid('getRowData', rowId);
                gcmscore.getSnippetPopup('collectionMenu', JSON.stringify(rowData));
            }));
        }
        gcmscore.createTableModal('Collections', 'collections', $('#admin-container'), null, lazyOptions);
    }

    function queryModal() {
        var lazyOptions = gcmscore.lazyOptions("mongoconfigurations");
        lazyOptions.afterLoadComplete = function (a, b) {
            b.addGridButton(new LCMSTemplateGridButton("fa-play", "Acties tonen", "", function () {
                var rowId = a.jqGrid('getGridParam', 'selrow');
                var rowData = a.jqGrid('getRowData', rowId);
                doQuery(rowData.name);
            }));
        }
        gcmscore.createTableModal('Queries', 'queries', $('#admin-container'), null, lazyOptions);
    }

    function queryModal() {
        var lazyOptions = gcmscore.lazyOptions("queries");
        lazyOptions.afterLoadComplete = function (a, b) {
            console.log("After load is complete function");
            b.addGridButton(new LCMSTemplateGridButton("fa-play", "Query uitvoeren", "", function () {
                var rowId = a.jqGrid('getGridParam', 'selrow');
                var rowData = a.jqGrid('getRowData', rowId);
                doQuery(rowData.name);
            }));
        }
        gcmscore.createTableModal('Queries', 'queries', $('#admin-container'), null, lazyOptions);
    }
    async function doQuery(name) {
        async function onDone(data) {
            try {
                console.log(data);
                var data = JSON.stringify(JSON.parse(data), null, 2);
                var modalBody = gcmscore.createModal('Query result', $('#admin-container'));
                modalBody.text(data);
            } catch (e) {
                console.log(e);
                return {};
            }
        }
        var requestOptions = {};
        requestOptions.action = "docommand";
        requestOptions.k = "doQuery";
        requestOptions.name = name;
        requestOptions.database = "lcms";
        let request = await LCMSRequest("./servlet", requestOptions);
        let returnvalue = await onDone(request);
        return returnvalue;
    }





</script>